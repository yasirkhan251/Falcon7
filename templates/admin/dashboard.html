{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .admin-container { padding: 40px 20px; background-color: var(--bg-color); color: var(--text-color); }
    .dynamic-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; max-width: 1200px; margin: 0 auto; }
    .item-card { background-color: var(--header-bg); border-radius: 12px; padding: 20px; text-align: center; text-decoration: none; color: var(--text-color); display: flex; flex-direction: column; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
    .item-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
    .image-wrapper { width: 100%; height: 180px; overflow: hidden; border-radius: 8px; margin-bottom: 15px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; font-size: 3rem; }
    .image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .admin-btn { padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; text-transform: uppercase; }
    .btn-folder { background: var(--accent); color: white; }
    .btn-product { background: #28a745; color: white; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
    .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--header-bg); padding: 30px; border-radius: 12px; width: 400px; border: 1px solid var(--accent); }
    .modal-content input { width: 100%; padding: 10px; margin: 10px 0; background: var(--bg-color); color: var(--text-color); border: 1px solid #444; }
</style>

<div class="admin-container">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2>{% if current_folder %}{{ current_folder.get_full_path }}{% else %}Root Directory{% endif %}</h2>
            <div>
                <button onclick="toggleModal('folderModal')" class="admin-btn btn-folder">+ New Folder</button>
                {% if current_folder %}<button onclick="toggleModal('productModal')" class="admin-btn btn-product">+ New Product</button>{% endif %}
            </div>
        </div>

        <div class="dynamic-grid">
            {% if current_folder %}
                <a href="{% if current_folder.parent %}{% url 'admin_dashboard_folder' current_folder.parent.id %}{% else %}{% url 'admin_dashboard' %}{% endif %}" class="item-card">
                    <div class="image-wrapper">‚¨ÖÔ∏è</div>
                    <h3>Back</h3>
                </a>
            {% endif %}

            {% for folder in sub_folders %}
                <a href="{% url 'admin_dashboard_folder' folder.id %}" class="item-card">
                    <div class="image-wrapper">
                        {% if folder.image %}<img src="{{ folder.image.url }}">{% else %}üìÅ{% endif %}
                    </div>
                    <h3>{{ folder.name }}</h3>
                </a>
            {% endfor %}

            {% for file in files %}
                <div class="item-card" style="border-bottom: 3px solid #28a745;">
                    <div class="image-wrapper">
                        {% if file.image %}<img src="{{ file.image.url }}">{% else %}üì±{% endif %}
                    </div>
                    <h3>{{ file.model_name }}</h3>
                    <p>{{ file.brand }} | ‚Çπ{{ file.price }}</p>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div id="folderModal" class="modal-overlay">
    <div class="modal-content">
        <form action="{% url 'add_folder' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="parent_id" value="{{ current_folder.id|default:'' }}">
            <h3>New Folder</h3>
            <input type="text" name="name" placeholder="Name" required>
            <button type="submit" class="admin-btn btn-folder">Create</button>
            <button type="button" onclick="toggleModal('folderModal')" class="admin-btn">Cancel</button>
        </form>
    </div>
</div>

<div id="productModal" class="modal-overlay">
    <div class="modal-content">
        <form action="{% url 'add_product' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="category_id" value="{{ current_folder.id }}">
            <h3>New Product</h3>
            <input type="text" name="brand" placeholder="Brand" required>
            <input type="text" name="model_name" placeholder="Model" required>
            <input type="number" name="price" placeholder="Price" required>
            <input type="number" name="stock" placeholder="Stock" required>
            <button type="submit" class="admin-btn btn-product">Add Product</button>
            <button type="button" onclick="toggleModal('productModal')" class="admin-btn">Cancel</button>
        </form>
    </div>
</div>

<script>
    function toggleModal(id) {
        const modal = document.getElementById(id);
        modal.style.display = (modal.style.display === 'none' || modal.style.display === '') ? 'block' : 'none';
    }
</script>
{% endblock %}